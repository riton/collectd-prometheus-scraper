---
name: 'ci-build'

on:
  - 'push'

jobs:
#   build:
#     name: 'Build collectd plugin'
#     runs-on: 'ubuntu-latest'
#     env:
#       DEBIAN_FRONTEND: 'noninteractive'
#       CGO_CPPFLAGS: '-I/usr/include/collectd/core/daemon -I/usr/include/collectd/core'
#       GOFLAGS: '-mod=vendor'
# 
#     steps:
#       - name: 'Install collectd-dev'
#         run: 'sudo apt install -y collectd-dev'
# 
#       - name: 'Checkout code'
#         uses: 'actions/checkout@master'
# 
#       - name: 'Install go'
#         uses: 'actions/setup-go@master'
#         with:
#           go-version: '1.13.4'
# 
#       - name: 'Test code'
#         run: 'go test -v ./...'
# 
#       - name: 'Build plugin'
#         run: 'go build -buildmode=c-shared -o prometheus_scraper.so'
# 
#       - name: 'Upload artifact'
#         uses: 'actions/upload-artifact@master'
#         with:
#           name: 'prometheus_scraper.so'
#           path: 'prometheus_scraper.so'

  rpm_package:
    name: 'Build an RPM of the collectd-plugin'
#    needs: 'build'
    runs-on: 'ubuntu-latest'
    container:
      image: 'remiferrand/fpm'

    steps:
#       - name: 'Download artifact from previous job'
#         uses: 'actions/download-artifact@master'
#         with:
#           name: 'prometheus_scraper.so'
#           path: 'prometheus_scraper.so'

      - name: 'debug'
        run: 'which fpm && ls -laF prometheus_scraper.so'
